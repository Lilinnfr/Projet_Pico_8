pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- main functions

function _init()
 create_player()
end

function _update()
 player_movement()
 update_camera()
end

function _draw()
 map_level_1()
	draw_player()
	draw_ui()
	--draw_time()
end
-->8
-- functions

--fonctions qui creent la map
function map_level_1()
	cls()
	map(0,0,0,0)
end

--fonctions qui crent le joueur
--et l'affichent

function create_player()
	p={
		x=6,
		y=3,
		sprite=1,
		keys=0
		}
end

	--fonction qui fait
	--regarder droite/gauche
function draw_player()
	spr(p.sprite, p.x*8, p.y*8, 1, 1, p.flip)
end

	--la camera suit les changements
	--de map
function update_camera()
	local camx=flr(p.x/16)*16
	local camy=flr(p.y/16)*16
	camera(camx*8,camy*8)
end


--fonction qui permet le deplacement
function player_movement()
	newx=p.x
	newy=p.y
	
	--mouvements
	--flip = retournement du sprite
	if (btnp(⬅️)) newx-=1 p.flip=true
	if (btnp(➡️)) newx+=1 p.flip=false
	if (btnp(⬆️)) newy-=1
	if (btnp(⬇️)) newy+=1
	
	--gestion des collisions
	if not check_flag(0,newx,newy) then
	p.x=newx
	p.y=newy
	end
	--si flag 0 pas de deplacement
	
	--player mvt appelle la 
	--fonction interact pour
	--recupere la cle
	interact(newx, newy)
	
	--interdiction sortie de la map
	if not check_flag(0,newx, newy) then
		p.x=mid(0,newx,127)
		p.y=mid(0,newy,63)
	else
		sfx(0)
	end
end



--recuperation des objets

	--verifie un flag
function check_flag(flag,x,y)
	local sprite=mget(x,y)
	return fget(sprite,flag)
end

 --verifie si la tile a 
 --le flag 1
function interact(x,y)
	if check_flag(1,x,y) then
		pick_up_key(x,y)
	end
end

--recupere la cle et keys +1
function pick_up_key(x,y)
	next_tile(x,y)
	p.keys+=1
	sfx(1)
end

--remplace la tuile objet
--par une tuile vide
function next_tile(x,y)
	local sprite=mget(x,y)
	mset(x,y,sprite+1)
end






-->8
-- user interface
function draw_ui()
 camera()
	spr(70,2,2)
	print("x"..p.keys,10,2,7)
end

--function draw_time()
-- print(flr(time(),10,10))
--end
-->8
--gestion timer
limit = 5

function _loose()
 if time() >= limit then
 cls()
 print("time's up!", 44, 60, 7)
 end
end
__gfx__
00000000000444003331333333313333333433333333b33333333333b333333333bbbb3333337333333333333333ccdc37cdc7333333333333b3333333333333
0000000000ffff00331213333318133333414333333b4b33343433333333bb333bbaabb33337a7333b3333333b3cc76ccccc6c3b3b333b33333333b333333333
000000000ffcfcf031222133318881333411143333bb44333474333333333b333bbbab133333733333333b33333c6ccc6cdccc333333333c3333333333333333
000000000ffffff01222221318888813411111433b444bb345754337333333333bbbb313b33333333333333333cccdccccccc33333b333c6333b333c33333333
0000000000ff4f0032020233380808333101013333bb4bb377577444333b3333313b3313333333b33333333333ccc7c3dccc33b3333333cc333333cc33333333
000000000f6666f0322222333888883331111133333b444b37e74444333b3333331111333333333333a333333ccdccc3cc733333333337cd3b3333cc33333333
000000000f7777f0324422333822883331221133333b4b333474477433b333b333322333333333333a9a33b33c7c6c33cdc3333333333cc733333ccc33333333
0000000000f77f00324422333822883331221133333343333434343433333b333314423333b3333333a333333c6ccc3b6c33b3333b33cc6c3333cccc33333333
4444444444ffff44444444444444444444ffff4444ffff4444ffff444444444444ffff4444ffff4444444444444444444444444444ffff440000000000000000
4444444444ffff44444444444444444444ffff4444ffff4444ffff444444444444ffff4444ffff4444444444444444444444444444ffff440000000000000000
ffffffff44ffff4444ffffffffffff4444ffffffffffff44ffffffffffffffffffffff4444ffffff44ffffffffffff4444ffff4444ffff440000000000000000
ffffffff44ffff4444ffffffffffff4444ffffffffffff44ffffffffffffffffffffff4444ffffff44ffffffffffff4444ffff4444ffff440000000000000000
ffffffff44ffff4444ffffffffffff4444ffffffffffff44ffffffffffffffffffffff4444ffffff44ffffffffffff4444ffff4444ffff440000000000000000
ffffffff44ffff4444ffffffffffff4444ffffffffffff44ffffffffffffffffffffff4444ffffff44ffffffffffff4444ffff4444ffff440000000000000000
4444444444ffff4444ffff4444ffff4444444444444444444444444444ffff4444ffff4444ffff44444444444444444444ffff44444444440000000000000000
4444444444ffff4444ffff4444ffff4444444444444444444444444444ffff4444ffff4444ffff44444444444444444444ffff44444444440000000000000000
33333333333333333333333883333333333333355333333333333335533333333333333dd3333333000000000000000000000000000000000000000000000000
3b3333000003333b3333338888388333333b33555533553333b3335555355b333333b3dddd366333000000000000000000000000000000000000000000000000
33330033bbb0033333b3388ff88ff333333335522553223333333559955993333b333dd11dd1133b000000000000000000000000000000000000000000000000
33303333333bb033333388ffff88f33b3b3355222255223333335599995593333333dd1111dd1333000000000000000000000000000000000000000000000000
3b303333bb33b03333388ffffff8833333355222222552333335599669955333333dd116611dd333000000000000000000000000000000000000000000000000
330333333bb33b033388ffffffff88333355222222225533335599966999553333dd11166111dd33000000000000000000000000000000000000000000000000
3303333333bb3b03388ffffffffff883355222222222255333599999999995333dd1111111111dd3000000000000000000000000000000000000000000000000
33033303330b3b0338ffffffffffff83552222222222225533399999999993333d111111111111d3000000000000000000000000000000000000000000000000
333030503050303333f66ff66ff66f33532662266226623533396669966693333316611661166133000000000000000000000000000000000000000000000000
333033050503303333f66ff66ff66f33332662266226623333396669966693333316611661166133000000000000000000000000000000000000000000000000
333300305030033333ffffffffffff3333222222222222333b399999999993333311111111111133000000000000000000000000000000000000000000000000
3b33330040033333b3ffff8888ffff33332222222222223333399999999993333311111111111133000000000000000000000000000000000000000000000000
333a33304033333333f66f2888f66f33332662444226623333396955596693333b16614441166133000000000000000000000000000000000000000000000000
33a9a330403333b333f66f2888f66f333b2662544226623b333969455966933b3316615441166133000000000000000000000000000000000000000000000000
333a33304033b33333f66f8888f66f3333222254422222333339994559999333331111544111113b000000000000000000000000000000000000000000000000
333333045503333333ffff8888ffff3b332222444222223333399955599993333311114441111133000000000000000000000000000000000000000000000000
33344443000033003333333333b3333b333b333b333b333b00000000000000000000000000000000000000000000000000000000000000000000000000000000
3444773300033000b33773b3b3377333933339333333333390000900000000000000000000000000000000000000000000000000000000000000000000000000
40443333099999903397733333377933939394933333333390909490000000000000000000000000000000000000000000000000000000000000000000000000
444444439909909933337337733733b349994394333b333349994094000000000000000000000000000000000000000000000000000000000000000000000000
344444449999999933b377777777333334449394333333b304449094000000000000000000000000000000000000000000000000000000000000000000000000
33347444909999093333777777773333b3334943b333333300004940000000000000000000000000000000000000000000000000000000000000000000000000
33443344990000993333393993933b33333334333333333300000400000000000000000000000000000000000000000000000000000000000000000000000000
34434443099999903b3333333333333b33b3333b33b3333b00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70707070707070701170707070707070707070707070117070707070704470700000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010101000101010101010101010000000000000000000000000000000000010101010101010101010000000000000101010101010101010100000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
070709070e0c0707070711070707070707070711070707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0708070a0b070807282911070707072021070711070707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070e0c070707383911070707093031070711070707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2425070b07262712101015070708070707070711070707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
34350d0c07363711070707090707070707070711070707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070a0b42071a101807070a0707070a0707070711070707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070e0c0707070819101010101010101010101018070707121010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
430b071a10101018070707070907080707070711070707110707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e0c070709070711070707070707070707070711070707110707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b070a0722230711070707090707070707070714101010180707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c07070732330711090707072021070707070707070707110707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
071a101010101018070707073031070907070707070707110707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070707070707071107070807070a070707070707070707110707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
070807070a070711070707070707070707070707070707110707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070711070707070707070707070707121010161010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070711070707070707070707070707110707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070728290711070707070707070707070707110707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070738390711070707070707070707070707110707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101018070707070707070707070707110707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070719101010130707070707070707110707070707070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070711070707191010101010101010161010101013070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070711070707110707070707070707070707070719101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070711070707110707070707070707070707070711070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070711070707141710101010101307070707070711070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070711070707071107070707071107070707070711070707070707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101018070707071107070707071107070707070719101010130707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070714171010101507070707071410101017101015070707110707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707110707070707070707070707070711070707070707110707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707110707070707070707070707070711070707070707110707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707110707070707070707070707070711070707070707110707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0707070707070707110707070707070707070707070711070707070707110707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07070707070707071107070707070707070707070707110707070707071d0707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000000000000000000000000000000000000000000000000000000000000002d05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
